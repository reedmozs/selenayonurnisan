<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíç Ni≈üan Anƒ±larƒ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #fce7f3 0%, #f3e8ff 50%, #dbeafe 100%);
            min-height: 100vh;
        }
        .gradient-text {
            background: linear-gradient(to right, #db2777, #9333ea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        .photo-card {
            position: relative;
            border-radius: 1rem;
            overflow: hidden;
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        .photo-card:hover {
            transform: scale(1.05);
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
        }
        .photo-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .overlay.active {
            display: flex;
        }
        .overlay img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="bg-white/80 backdrop-blur-sm shadow-lg sticky top-0 z-10">
        <div class="max-w-6xl mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold gradient-text">üíç Ni≈üan Anƒ±larƒ±</h1>
                    <p class="text-gray-600 mt-1" id="photoCount">0 fotoƒüraf y√ºklendi</p>
                </div>
                <button onclick="toggleAdmin()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition" id="adminBtn">
                    Y√∂netici Giri≈üi
                </button>
            </div>
        </div>
    </div>

    <div class="max-w-6xl mx-auto px-4 py-8">
        <!-- Y√ºkleme Alanƒ± (Misafir) -->
        <div id="uploadSection" class="bg-white rounded-2xl shadow-xl p-8 mb-8 border-2 border-dashed border-purple-300">
            <div class="text-center">
                <div class="inline-block p-4 bg-gradient-to-br from-pink-100 to-purple-100 rounded-full mb-4">
                    <svg class="w-12 h-12 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Fotoƒüraflarƒ±nƒ±zƒ± Y√ºkleyin</h2>
                <p class="text-gray-600 mb-6">Ni≈üandan √ßektiƒüiniz fotoƒüraflarƒ± bizimle payla≈üƒ±n! üéâ</p>
                
                <label class="inline-block cursor-pointer">
                    <input type="file" multiple accept="image/*" id="fileInput" class="hidden" onchange="handleUpload(event)">
                    <div class="px-8 py-4 bg-gradient-to-r from-pink-600 to-purple-600 text-white rounded-xl font-semibold hover:shadow-lg transform hover:scale-105 transition">
                        Fotoƒüraf Se√ß
                    </div>
                </label>
                
                <div id="successMsg" class="mt-4 hidden">
                    <div class="inline-flex items-center gap-2 px-4 py-2 bg-green-100 text-green-700 rounded-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        Fotoƒüraf ba≈üarƒ±yla y√ºklendi!
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Kontrolleri -->
        <div id="adminControls" class="hidden">
            <div id="selectionBar" class="bg-white rounded-xl shadow-lg p-4 mb-6 flex items-center justify-between" style="display: none;">
                <span class="text-gray-700 font-medium" id="selectionCount">0 fotoƒüraf se√ßildi</span>
                <div class="flex gap-2">
                    <button onclick="downloadSelected()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                        </svg>
                        Se√ßilenleri ƒ∞ndir
                    </button>
                    <button onclick="deleteSelected()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                        Sil
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-4 mb-6 flex justify-end">
                <button onclick="downloadAll()" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                    </svg>
                    <span id="downloadAllText">T√ºm√ºn√º ƒ∞ndir (0)</span>
                </button>
            </div>
        </div>

        <!-- Fotoƒüraf Galerisi -->
        <div id="gallery" class="photo-grid"></div>

        <!-- Bo≈ü Durum -->
        <div id="emptyState" class="text-center py-16 bg-white rounded-2xl shadow-lg">
            <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            <p class="text-gray-500 text-lg">Hen√ºz fotoƒüraf y√ºklenmemi≈ü</p>
        </div>
    </div>

    <!-- Tam Ekran G√∂r√ºnt√ºleme -->
    <div id="overlay" class="overlay" onclick="closeOverlay()">
        <button class="absolute top-4 right-4 text-white bg-black/50 rounded-full p-3 hover:bg-black/70" onclick="closeOverlay()">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
        <img id="overlayImage" src="" alt="B√ºy√ºk g√∂r√ºn√ºm">
    </div>

    <!-- Footer -->
    <div class="text-center py-8 text-gray-600">
        <p class="text-sm">T√ºm fotoƒüraflar g√ºvenli bir ≈üekilde saklanmaktadƒ±r üíù</p>
    </div>

    <script>
        let isAdmin = false;
        let selectedPhotos = [];
        let photos = [];

        // Sayfa y√ºklendiƒüinde fotoƒüraflarƒ± y√ºkle
        window.onload = function() {
            loadPhotos();
        };

        async function loadPhotos() {
            try {
                const result = await window.storage.list('photo:', true);
                if (result && result.keys) {
                    const photoPromises = result.keys.map(async (key) => {
                        try {
                            const data = await window.storage.get(key, true);
                            return data ? { key, ...JSON.parse(data.value) } : null;
                        } catch (e) {
                            return null;
                        }
                    });
                    const photoData = await Promise.all(photoPromises);
                    photos = photoData.filter(p => p !== null).sort((a, b) => b.timestamp - a.timestamp);
                    renderGallery();
                }
            } catch (error) {
                console.log('Hen√ºz fotoƒüraf y√ºklenmemi≈ü');
                photos = [];
                renderGallery();
            }
        }

        function renderGallery() {
            const gallery = document.getElementById('gallery');
            const emptyState = document.getElementById('emptyState');
            const photoCount = document.getElementById('photoCount');
            const downloadAllText = document.getElementById('downloadAllText');

            photoCount.textContent = `${photos.length} fotoƒüraf y√ºklendi`;
            downloadAllText.textContent = `T√ºm√ºn√º ƒ∞ndir (${photos.length})`;

            if (photos.length === 0) {
                gallery.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            gallery.style.display = 'grid';
            emptyState.style.display = 'none';

            gallery.innerHTML = photos.map(photo => `
                <div class="photo-card">
                    ${isAdmin ? `
                        <button onclick="toggleSelection('${photo.key}')" class="absolute top-2 left-2 z-10 w-6 h-6 rounded-full border-2 flex items-center justify-center transition ${
                            selectedPhotos.includes(photo.key) ? 'bg-purple-600 border-purple-600' : 'bg-white border-gray-300'
                        }">
                            ${selectedPhotos.includes(photo.key) ? `
                                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                            ` : ''}
                        </button>
                    ` : ''}
                    <img src="${photo.data}" alt="Ni≈üan fotoƒürafƒ±" onclick="openOverlay('${photo.data}')" style="cursor: pointer;">
                </div>
            `).join('');
        }

        async function handleUpload(event) {
            const files = Array.from(event.target.files);
            if (files.length === 0) return;

            for (const file of files) {
                if (file.size > 5 * 1024 * 1024) {
                    alert('Dosya boyutu 5MB\'dan k√º√ß√ºk olmalƒ±dƒ±r');
                    continue;
                }

                const reader = new FileReader();
                reader.onload = async (e) => {
                    try {
                        const photoId = `photo:${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                        const photoData = {
                            data: e.target.result,
                            timestamp: Date.now(),
                            name: file.name
                        };
                        
                        await window.storage.set(photoId, JSON.stringify(photoData), true);
                        await loadPhotos();
                        
                        const successMsg = document.getElementById('successMsg');
                        successMsg.classList.remove('hidden');
                        setTimeout(() => successMsg.classList.add('hidden'), 3000);
                    } catch (error) {
                        console.error('Y√ºkleme hatasƒ±:', error);
                        alert('Fotoƒüraf y√ºklenirken bir hata olu≈ütu');
                    }
                };
                reader.readAsDataURL(file);
            }

            event.target.value = '';
        }

        function toggleAdmin() {
            isAdmin = !isAdmin;
            const adminBtn = document.getElementById('adminBtn');
            const uploadSection = document.getElementById('uploadSection');
            const adminControls = document.getElementById('adminControls');

            adminBtn.textContent = isAdmin ? 'Misafir G√∂r√ºn√ºm√º' : 'Y√∂netici Giri≈üi';
            uploadSection.style.display = isAdmin ? 'none' : 'block';
            adminControls.classList.toggle('hidden', !isAdmin);
            
            selectedPhotos = [];
            renderGallery();
            updateSelectionBar();
        }

        function toggleSelection(key) {
            if (selectedPhotos.includes(key)) {
                selectedPhotos = selectedPhotos.filter(k => k !== key);
            } else {
                selectedPhotos.push(key);
            }
            renderGallery();
            updateSelectionBar();
        }

        function updateSelectionBar() {
            const selectionBar = document.getElementById('selectionBar');
            const selectionCount = document.getElementById('selectionCount');
            
            if (selectedPhotos.length > 0) {
                selectionBar.style.display = 'flex';
                selectionCount.textContent = `${selectedPhotos.length} fotoƒüraf se√ßildi`;
            } else {
                selectionBar.style.display = 'none';
            }
        }

        function downloadSelected() {
            selectedPhotos.forEach(key => {
                const photo = photos.find(p => p.key === key);
                if (photo) {
                    const link = document.createElement('a');
                    link.href = photo.data;
                    link.download = photo.name || 'nisan-fotograf.jpg';
                    link.click();
                }
            });
        }

        function downloadAll() {
            photos.forEach(photo => {
                const link = document.createElement('a');
                link.href = photo.data;
                link.download = photo.name || 'nisan-fotograf.jpg';
                link.click();
            });
        }

        async function deleteSelected() {
            if (!confirm('Se√ßili fotoƒüraflarƒ± silmek istediƒüinize emin misiniz?')) return;
            
            for (const key of selectedPhotos) {
                await window.storage.delete(key, true);
            }
            selectedPhotos = [];
            await loadPhotos();
            updateSelectionBar();
        }

        function openOverlay(imageSrc) {
            const overlay = document.getElementById('overlay');
            const overlayImage = document.getElementById('overlayImage');
            overlayImage.src = imageSrc;
            overlay.classList.add('active');
        }

        function closeOverlay() {
            const overlay = document.getElementById('overlay');
            overlay.classList.remove('active');
        }
    </script>
</body>
</html>